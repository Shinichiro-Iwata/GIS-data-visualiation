---
title: "人口集中地区データを用いた郊外化の可視化"
subtitle: "高松市，富山市，熊本市の例"
author: "[岩田真一郎](https://shinichiro-iwata.github.io/)（[神奈川大学経済学部](https://www.econ.kanagawa-u.ac.jp/)）"
date: '`r Sys.Date()`'
output: 
  html_document:
    highlight: "pygments"
---
# 目的
国土数値情報のDID人口集中地区（ポリゴン）を利用して地方都市の郊外化を可視化．

- 地方都市ではモータリゼーションの進展とそれに伴い市街地が外延．
- 郊外化を示す方法の一つして，人口が集まっている地域，人口集中地区（[DID](https://ja.wikipedia.org/wiki/%E4%BA%BA%E5%8F%A3%E9%9B%86%E4%B8%AD%E5%9C%B0%E5%8C%BA)：Densely inhabited districtの略），の面積の拡大によって示す方法がある．

  - 実際に，内閣府により認定された地方都市の[中心市街地活性化基本計画](https://www.chisou.go.jp/tiiki/chukatu/nintei.html)には郊外化の現状を人口集中地区面積の増大や，人口集中地区の人口密度の低下を用いて示している．
  - ここでは，香川県高松市の第3期[高松市中心市街地活性化計画](https://www.city.takamatsu.kagawa.jp/kurashi/shinotorikumi/machidukuri/kasseika/chushin/index.html)（アクセス日：2022/06/09）の第1章7頁の 図「[DID区域の変遷](https://www.city.takamatsu.kagawa.jp/kurashi/shinotorikumi/machidukuri/kasseika/chushin/3rd.files/section1.pdf)」（アクセス日：2022/06/09）を参考に1975年と2015年の人口集中地区の地図を重ね，その変換を可視化．
  - 高松市，富山県富山市（第1期[富山市中心市街地活性化計画](https://www.city.toyama.toyama.jp/katsuryokutoshisouzoubu/machidukuri/chushinshigaichi.html)（アクセス日：2022/06/09）は2007年2月8日に内閣総理大臣から最初に認定された），政令指定都市の熊本県熊本市を取り上げる．熊本市も[熊本市中心市街地活性化計画（熊本地区）](https://www.city.kumamoto.jp/hpKiji/pub/detail.aspx?c_id=5&id=806&class_set_id=2&class_id=2628)（アクセス日：2022/06/09）が認定されている．

ライブラリ：`sf`，`tidyverse`
```{r, warning=FALSE, message=FALSE}
library(sf)
library(tidyverse)
```

# 高松市の人口集中地区の可視化
**シェープファイルのダウンロード**

- [国土数値情報ダウンロードサービス](https://nlftp.mlit.go.jp/ksj/)　>　行政区域（ポリゴン）　>　香川県　>　令和3年　

  - ダウンロードしたZIPファイルは同じディレクトリに納め，ZIPファイルを選択 >　右クリック　>　解凍　>　ここで解凍　を実行する．解凍後は最初にダウンロードしたZIPファイルを削除．
  - `read_sf`：データ読込．`Kagawa_map`と名付ける．
  - `Kagawa_map`から高松市（行政区域コード`N03_007`の`37201`）を切り抜き，新しいデータを`Takamatsu_shi_map`とする．

```{r}
Kagawa_map<-
  read_sf("N03-20210101_37_GML/N03-21_37_210101.shp")
```

```{r}
Kagawa_map %>%
  filter(N03_007=="37201") ->
  Takamatsu_shi_map
```  

時系列の変化を見るため，例として1975年（昭和50年）と2015年（平成27年）の人口集中地区のシェープファイルをダウンロードする．

- [国土数値情報ダウンロードサービス](https://nlftp.mlit.go.jp/ksj/)　>　DID人口集中地区（ポリゴン）　>　香川県　>　世界測地系	昭和50年（および平成27年）

  - ダウンロードしたZIPファイルは同じディレクトリに納め，ZIPファイルを選択 >　右クリック　>　解凍　>　ここで解凍　を実行する．解凍後は最初にダウンロードしたZIPファイルを削除．
  - `read_sf`：データ読込．`Kagawa_DID75`，`Kagawa_DID15`と名付ける．
  - `crs="WGS84"`は`crs`（Coordinate ReferenceSystem，座標参照系）を1984年に定められた世界測地系(World Geodetic System)に投影を意味．この指示をしないとエラーが出現．
  - `Kagawa_DID#`（`#`は`75`か`15`）から高松市（行政区域コード`A16_002`の`37201`）を切り抜き，新しいデータを`Takamatsu_shi_DID#`とする．
  
```{r}
#1975年の人口集中地区データの読込
Kagawa_DID75<-
  read_sf("A16-75_37_GML/A16-75_37_DID.shp", 
                      crs="WGS84") 

#高松市の人口集中地区データの作成
Kagawa_DID75 %>%
  filter(A16_002=="37201") ->
  Takamatsu_shi_DID75
```  


```{r}
#2015年の人口集中地区データの読込
Kagawa_DID15<-
  read_sf("A16-15_37_GML/A16-15_37_GML/A16-15_37_DID.shp", 
                      crs="WGS84") 

#高松市の人口集中地区データの作成
Kagawa_DID15 %>%
  filter(A16_002=="37201") ->
  Takamatsu_shi_DID15
```

地図上に鉄道（ライン）を可視化．

- [国土数値情報ダウンロードサービス](https://nlftp.mlit.go.jp/ksj/)　>　鉄道（ライン）　>　全国　>　世界測地系 >　令和2年　

  - 鉄道データは全国のみ．
  - ダウンロードしたZIPファイルは同じディレクトリに納め，ZIPファイルを選択 >　右クリック　>　解凍　>　ここで解凍　を実行する．解凍後は最初にダウンロードしたZIPファイルを削除．
  - `railway20`と名付ける．
  
```{r}
railway20<-read_sf("N02-20_GML/N02-20_GML/N02-20_RailroadSection.shp")
```

**人口集中地区の可視化**

- 地図を5枚（ここでは6枚）重ねる．
  - **最背面**：香川県の行政地区の地図（`Kagawa_map`）．
  - **下から2番目**：高松市の行政地区の地図（`Takamatsu_shi_map`）．背面は白に塗る（`fill`）ように指示．境界線を強調するため，境界線の太さ（`size`）を指示．
  - **下から3番目**：2015年の人口集中地区の地図（`Takamatsu_shi_DID15`）．2015年のほうが1975年よりも人口集中地区が大きいため，地図を下に配置．色は緑系をここでは利用．
  - **下から4番目**：1975年の人口集中地区の地図（`Takamatsu_shi_DID75`）．色は青系を利用．
  - （**注意**：2015年の人口集中地区の境界線（`dark green`）は1975年のそれに比べ，外側に広がっただけなく，内側に狭まった箇所もある．そのような箇所は，1975年の地図で見えなくなってしまうため，下から4番目として2015年の人口集中地区の境界線（`dark green`，ただし境界内は透明（`fill="NA"`））の地図（`Takamatsu_shi_DID15`）を重ねている．）
  - **最前面**：鉄道の地図（`railway20`）．線の太さ（`size`）と線が境界線と区別（`linetype`）できるように指示．
  
- `coord_sf()`：緯度（`x`）と経度（`y`）を用いて地図の範囲を指定．

```{r}
ggplot()+
  geom_sf(data=Kagawa_map)+
  geom_sf(data=Takamatsu_shi_map, fill="white", 
          size=0.8)+
  geom_sf(data=Takamatsu_shi_DID15, fill="green", 
          color="dark green")+
  geom_sf(data=Takamatsu_shi_DID75, fill="light blue",
          color="blue")+
  geom_sf(data=Takamatsu_shi_DID15, fill="NA", 
          color="dark green")+
  geom_sf(data=railway20, size=0.2, 
          linetype="dashed")+
  coord_sf(xlim=c(133.80, 134.24), 
           ylim=c(34.19, 34.42))+
  ggtitle("高松市の人口集中地区の変遷", 
          subtitle="（1975年ｰ2015年）")+
  theme_bw()
```

**凡例の作成**

1975年と2015年の人口集中地区の凡例を作成．

- ↑の地図との違い．
  - 人口集中地区の境界内の色と境界線と色を`aes()`で指示．
  - `scale_fill_manual()`と`scale_color_manual()`を用いて手動で境界内の色と境界線と色を指示．色を除く内容を揃えることで，凡例を一つにまとめる．

```{r}
#凡例の作成
ggplot()+
  geom_sf(data=Kagawa_map)+
  geom_sf(data=Takamatsu_shi_map, fill="white", 
          size=0.8)+
  geom_sf(data=Takamatsu_shi_DID15, 
          aes(fill="2015年", color="2015年"))+
  geom_sf(data=Takamatsu_shi_DID75, 
          aes(fill="1975年", color="1975年"))+
  scale_fill_manual(name="人口集中地区", 
                    labels=c("1975年", "2015年"),
                    values=c("light blue", "green"))+
  scale_color_manual(name="人口集中地区", 
                     labels=c("1975年", "2015年"),
                     values=c("blue", "dark green"))+
  geom_sf(data=Takamatsu_shi_DID15, fill="NA", 
          color="dark green")+
  geom_sf(data=railway20, size=0.2, 
          linetype="dashed")+
  coord_sf(xlim=c(133.80, 134.24), 
           ylim=c(34.19, 34.42))+
  ggtitle("高松市の人口集中地区の変遷",
          subtitle="（1975年ｰ2015年）")+
  theme_bw()
```

**参考（高松市DID人口密度）**

↑で利用したDID人口集中地区のデータには人口集中地区の人口（人）や面積（k㎡）が示されている．この数値から人口密度（人／k㎡）が計算できる．
 
- 1975年と2015年の人口，面積，人口密度を表にまとめる．

```{r echo = FALSE}
d <- tibble(
  年 = c(1975, 2015),
  人口 = c(179426, 212897),
  面積 = c(29.40, 41.04),　
  人口密度 = c(6102.925,　5187.549)
  )

library(gt)
t<-d %>% gt()
t %>% tab_header(title="高松市の人口集中地区人口密度（人／k㎡）") 
```

# 富山市の人口集中地区の可視化
同じ作業のため，コードは記さない．

```{r echo = FALSE}
Toyama_map<-read_sf("N03-20210101_16_GML/N03-20210101_16_GML/N03-21_16_210101.shp")
```

```{r echo = FALSE}
Toyama_map %>%
  filter(N03_007=="16201") ->
  Toyama_shi_map
```  

```{r echo = FALSE}
Toyama_DID75<-read_sf("A16-75_16_GML/A16-75_16_DID.shp", 
                      crs="WGS84") 
```

- **注意**：1975年は市町村合併前のため，富山県婦負郡八尾町が富山市の行政区域コード（`A16_002`）と異なる．そこで，富山市（`16201`）だけでなく八尾町（`16361`）も含めて，1975年の富山市の人口集中地区データを作成．
  - 2015年には，この地区は人口集中地区の要件を満たしていない．↓の地図参照．　

```{r}
Toyama_DID75 %>%
  filter(A16_002=="16201" | A16_002=="16361") ->
  Toyama_shi_DID75
```  

```{r echo=FALSE}
Toyama_DID15<-read_sf("A16-15_16_GML/A16-15_16_GML/A16-15_16_DID.shp", 
                      crs="WGS84") 
```

```{r echo=FALSE}
Toyama_DID15 %>%
  filter(A16_002=="16201") ->
  Toyama_shi_DID15
```

**人口集中地区の可視化**

```{r echo=FALSE}
ggplot()+
  geom_sf(data=Toyama_map)+
  geom_sf(data=Toyama_shi_map, size=0.8, fill="white")+
  geom_sf(data=Toyama_shi_DID15, aes(fill="2015年", color="2015年"))+
  geom_sf(data=Toyama_shi_DID75, aes(fill="1975年", color="1975年"))+
  scale_fill_manual(name="人口集中地区", labels=c("1975年", "2015年"), values=c("light blue", "green"))+
  scale_color_manual(name="人口集中地区", labels=c("1975年", "2015年"), values=c("blue", "dark green"))+
  geom_sf(data=Toyama_shi_DID15, fill="NA", color="dark green")+
  geom_sf(data=railway20, size=0.2, linetype=2)+
  coord_sf(xlim= c(136.96, 137.4), ylim=c(36.5, 36.78))+
  ggtitle("富山市の人口集中地区の変遷",
          subtitle="（1975年ｰ2015年）")+
  theme_bw()
```

**参考（富山市DID人口密度）**

```{r echo = FALSE}
dt <- tibble(
  年 = c(1975, 2015),
  人口 = c(166572, 235868),
  面積 = c(32.00, 57.89),　
  人口密度 = c(5205.375, 4074.417)
  )

library(gt)
tt<-dt %>% gt()
tt %>% tab_header(title="富山市の人口集中地区人口密度（人／k㎡）") 
```

# 熊本市の人口集中地区の可視化
同じ作業のため，コードは記さない．

- ただし，2012年度から政令指定都市になったため，行政区域のコードに注意すること．

```{r echo = FALSE}
Kumamoto_map<-
  read_sf("N03-20210101_43_GML/N03-20210101_43_GML/N03-21_43_210101.shp")
```

```{r echo = FALSE}
Kumamoto_map %>%
  filter(N03_003=="熊本市") ->
  Kumamoto_shi_map
```  

```{r echo = FALSE}
Kumamoto_DID75<-
  read_sf("A16-75_43_GML/A16-75_43_DID.shp", 
                      crs="WGS84") 
```

```{r echo = FALSE}
Kumamoto_DID75 %>%
  filter(A16_002=="43201") ->
  Kumamoto_shi_DID75
```  

```{r echo=FALSE}
Kumamoto_DID15<-read_sf("A16-15_43_GML/A16-15_43_GML/A16-15_43_DID.shp", 
                      crs="WGS84") 
```

- **注意**：2015年は行政区域コード（`A16_002`）の`43101`から`43105`が熊本市．
  
```{r}
Kumamoto_DID15 %>%
  filter(A16_002>="43101" & A16_002<="43105") ->
  Kumamoto_shi_DID15
```

**人口集中地区の可視化**

```{r echo=FALSE}
ggplot()+
  geom_sf(data=Kumamoto_map)+
  geom_sf(data=Kumamoto_shi_map, size=0.8, fill="white")+
  geom_sf(data=Kumamoto_shi_DID15, 
          aes(fill="2015年", color="2015年"))+
  geom_sf(data=Kumamoto_shi_DID75, 
          aes(fill="1975年", color="1975年"))+
  scale_fill_manual(name="人口集中地区", 
                    labels=c("1975年", "2015年"),
                    values=c("light blue", "green"))+
  scale_color_manual(name="人口集中地区", 
                     labels=c("1975年", "2015年"),
                     values=c("blue", "dark green"))+
  geom_sf(data=Kumamoto_shi_DID15, fill="NA", color="dark green")+
  geom_sf(data=railway20, size=0.2, linetype=2)+
  coord_sf(xlim= c(130.46, 130.9), ylim=c(32.65, 32.95))+
  ggtitle("熊本市の人口集中地区の変遷",
          subtitle="（1975年ｰ2015年）")+
  theme_bw()
```

**注意**：熊本市北部に2015年に1975年には存在しなかった人口集中地区が加わっている．この地区は[熊本市中心市街地活性化基本計画（植木地区）](https://www.city.kumamoto.jp/hpKiji/pub/detail.aspx?c_id=5&id=1545&class_set_id=3&class_id=663)（アクセス日：2022/06/09）が別途認定されている．

**参考（熊本市DID人口密度）**

熊本市（植木地区を含む）の人口密度は高くなっている．

```{r echo = FALSE}
dt <- tibble(
  年 = c(1975, 2015),
  人口 = c(379589, 587816),
  面積 = c(51.00, 88.76),　
  人口密度 = c(7442.922, 10154.020)
  )

library(gt)
tt<-dt %>% gt()
tt %>% tab_header(title="熊本市の人口集中地区人口密度（人／k㎡）") 
```


**Rによる地理空間データの可視化**

- チュートリアル[ホーム](https://shinichiro-iwata.github.io/geospatial-data-visualization/)